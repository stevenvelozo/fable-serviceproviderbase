# API Reference

## Class: FableServiceProviderBase

The base class for all Fable services. Import it and extend it to create your own services.

```javascript
const libFableServiceProviderBase = require('fable-serviceproviderbase');

class MyService extends libFableServiceProviderBase
{
    constructor(pFable, pOptions, pServiceHash)
    {
        super(pFable, pOptions, pServiceHash);
        this.serviceType = 'MyService';
    }
}
```

## Constructor

```javascript
new FableServiceProviderBase(pFable, pOptions, pServiceHash)
```

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `pFable` | Fable instance or object | No | A Fable instance, or an options object if no Fable is available |
| `pOptions` | object or string | No | Options for the service, or the service hash if no Fable |
| `pServiceHash` | string | No | Unique identifier for this service instance |

See [Initialization Patterns](initialization-patterns.md) for detailed usage of each parameter combination.

## Instance Properties

### fable

- **Type:** Fable instance or `false`
- **Description:** Reference to the connected Fable instance. Set to `false` when no Fable is connected.

### log

- **Type:** object or `undefined`
- **Description:** Shortcut to `fable.Logging`. Provides `trace()`, `debug()`, `info()`, `warn()`, `error()`, and `fatal()` methods.

### UUID

- **Type:** string
- **Description:** Unique identifier for this service instance. Generated by Fable's UUID service when connected, or a random `CORE-SVC-XXXXX` string when standalone.

### Hash

- **Type:** string
- **Description:** The service instance hash, used to look up this specific instance in the service registry. Defaults to the UUID if not provided.

### serviceType

- **Type:** string
- **Description:** The registered type name for this service. Defaults to `'Unknown-{UUID}'`. Subclasses should set this in their constructor.

### options

- **Type:** object
- **Description:** Service-specific configuration passed during construction.

### services

- **Type:** object or `undefined`
- **Description:** Reference to `fable.services`. Provides shortcut access to the default instance of each registered service type.

### servicesMap

- **Type:** object or `undefined`
- **Description:** Reference to `fable.servicesMap`. A two-level map: `servicesMap[serviceType][hash]` returns a specific service instance.

### _PackageFableServiceProvider

- **Type:** object
- **Description:** The `package.json` contents of fable-serviceproviderbase. Useful for version checking.

## Instance Methods

### connectFable(pFable)

Connects a Fable instance to this service. Used for core services that were constructed before Fable was initialized.

```javascript
let tmpResult = myService.connectFable(fableInstance);
```

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `pFable` | Fable instance | Yes | Must have `isFable` property set to `true` |

**Returns:** `true` on success, or an `Error` if the parameter is not a valid Fable instance.

**Behavior:**
- Sets `this.fable` if not already set
- Sets `this.log` to `fable.Logging` if not already set
- Sets `this.services` to `fable.services` if not already set
- Sets `this.servicesMap` to `fable.servicesMap` if not already set
- Idempotent: calling multiple times will not overwrite existing references

## Static Properties

### isFableService

- **Type:** boolean
- **Value:** `true`
- **Description:** Class-level flag that identifies a class as a Fable service. Used by the service manager to validate service types.

## Exports

### Default Export

The `FableServiceProviderBase` class itself.

```javascript
const libBase = require('fable-serviceproviderbase');
class MyService extends libBase { ... }
```

### CoreServiceProviderBase

An alias for `FableServiceProviderBase`. They are the same class.

```javascript
const libBase = require('fable-serviceproviderbase');
class MyCoreService extends libBase.CoreServiceProviderBase { ... }
```

The alias exists for readability when building services that are designed to be constructed before Fable is initialized.
